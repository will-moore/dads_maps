<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Create a polygon</title>

<script src="http://openspace.ordnancesurvey.co.uk/osmapapi/openspace.js?key=264BA109582B0BB3E0530B6CA40A9FE6"></script>
<script src="js/coords.js"></script>

<style>
    html, body {
        height: 100%;
        margin: 0;
    }
    #map {
        width: 100%;
        height: 100%;
        background: rgb(155, 205, 255);
    }
</style>


<script type="text/javascript">

console.log("DATA", DATA.length);

// Define the osMap variable

var osMap;

// This function creates the map and is called by the div in the HTML

function init() {

    var baseStyle ={
        strokeColor: "#ff00ff",
        strokeOpacity: 1,
        strokeWidth: 2,
        fillColor: "#ff00ff",
        fillOpacity: 0.1
    };
    var selectStyle = {
        strokeColor: "#ff00ff",
        strokeOpacity: 1,
        strokeWidth: 2,
        fillColor: "#ff00ff",
        fillOpacity: 0.4
    }
    
    // Create new map
    var options = {resolutions: [2500, 1000, 500, 200, 100, 50, 25, 10, 5]};
    osMap = new OpenSpace.Map('map', options);
    // Set map centre in National Grid Eastings and Northings and select zoom level 0
    osMap.setCenter(new OpenSpace.MapPoint(270000, 720000), 3);
    // Create a new vector layer to hold the polygon
    var vectorLayer = new OpenLayers.Layer.Vector("Vector Layer");

    // This works, but means that you can't drag the map around when over shapes
    // var selectControl = new OpenLayers.Control.SelectFeature(vectorLayer, {
    //     multiple: true,
    //     clickout: true,
    //     toggle: true,
    //     hover: true,
    //     selectStyle: selectStyle,
        // onSelect: onFeatureHover,
        // onUnselect: onFeatureHoverOff,
    // });    
    // osMap.addControl(selectControl);
    // selectControl.activate();

    // function onFeatureHover(feature) {
    //     // var name = feature.attributes.NAME;
    //     feature.style.fillOpacity = 0.1;

    //     console.log(feature, feature.style.fillOpacity);
    // }

    // function onFeatureHoverOff(feature) {
    //     // var name = feature.attributes.NAME;
    //     // feature.style.fillOpacity = 0.2;

    //     console.log(feature, feature.style.fillOpacity);
    // }  
    
    osMap.addLayer(vectorLayer);
    
    // Draw rectangles - p is list of 
    var drawRect = function(p) {
      
        var coords = [[p[0], p[1]],
                    [p[2], p[1]],
                    [p[2], p[3]],
                    [p[0], p[3]] ]
        var corners = coords.map(function(p){
            return new OpenLayers.Geometry.Point(p[0], p[1]);
        });
        var linearRing = new OpenLayers.Geometry.LinearRing(corners);
        var polygonFeature = new OpenLayers.Feature.Vector(linearRing, null, baseStyle);

        vectorLayer.addFeatures([polygonFeature]);
        return polygonFeature;
    };
    
    DATA.forEach(function(data){

        drawRect(data.coords);
    });

    // drawRect([270000, 720000, 310000, 760000]);
    // drawRect([294000, 720000, 334000, 760000]);
    // var f = drawRect([334000, 720000, 374000, 760000]);

    // selectControl.select(f);
    // selectControl.deactivate();
  }


</script>


</head>  
  
<body onload="init()">
  
<!-- The div below holds the map -->
  
<div id="map"></div>
  
</body>
</html>
